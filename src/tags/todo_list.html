<todo_list>
    <style>
    </style>
    <div riot-tag="todo_new"></div>
    <div each="{opts.results}" draggable="true" o-type="todo" o-id="{objectId}" todo_id="{objectId}"
         ondragstart="{web.ondrag}" name="{name}"
         onclick="{edit}">
        <input type="checkbox" value="" onclick="{finish_todo}" todo_id={objectId} checked="{finish}">{name}
    </div>
    <script>
        var self = this;
        self.finish_todo = function (e) {
            var id = e.target.getAttribute('todo_id');
            var services = e.target.checked ? web.services.todo.finish : web.services.todo.unfinish;
            services(id, function (data) {
                if (data && data.code == 0) {
                    web.message('操作成功！');
                    $(e.target).parent().remove();
                } else {
                    web.message((data && data.message) || '操作失败！');
                }
            });
        };
        web.on('new_todo', function (data) {
            if (data && data.objectId) {
                self.opts.results.unshift(data);
                self.update();
            } else {
                web.message('新任务内容为空！');
            }
        });
        self.edit = function (e) {
            var id = e.target.getAttribute('o-id');
            if (id) {
                web.services.todo.get(id, function (result) {
                    if (result && result.code == 0 && result.data) {
                        web.dialog('edit', {title: '任务详情', type: 'todo', data: result.data});
                    } else {
                        web.errmsg(result, '未找到任务！')
                    }
                });
            }
        };
    </script>
</todo_list>


